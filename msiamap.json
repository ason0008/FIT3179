{
    "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
    "data": {
        "name": "map_population_density",
        "url": "https://ason0008.github.io/FIT3179/data/state_boundaries.json",
        "format": {"property": "features"}
    },
    "vconcat": [
        {
          "encoding": {
            "color": {
              "condition": {
                "selection": "click",
                "field": "properties.population_density",
                "type": "quantitative",
                "scale": {"scheme": "yellowgreenblue"},
                "legend": {"title": "Population Density"}
              },
              "value": "lightgray"
            },
            "tooltip": [
              {
                "field": "properties.state", 
                "type": "nominal",
                "title": "State"
              },
              {
                "field": "properties.population_density",
                "type": "quantitative",
                "title": "Population Density"
              }
            ]
          },
          "selection": {
            "click": {
                "fields": ["properties.state"], 
                "type": "single"
            }
          },
          "mark": {
            "type": "geoshape",
            "stroke": "#000000",
            "strokeWidth": 0.5
          },
          "width": 300,
          "height": 100
        },
        {
          "transform":[{"filter": {"selection": "click"}},
            {
              "lookup": "properties.state",
              "from": {
                "data": 
                {
                  "name": "age_ethnic",
                  "url": "https://ason0008.github.io/FIT3179/data/age_ethnic.json"
                },
              "key": "state",
              "fields": ["state", "age", "ethnicity", "population"]
              }
            }
          ],
          "encoding": {
            "x": {
              "field": "ethnicity",
              "type": "nominal",
              "title": "Ethnicity",
              "scale": {"domain": ["Bumiputera", "Chinese", "Indians", "Others", "Non-Malaysian Citizens"]},
              "axis": {"labelAngle": -45}
            },
            "y": {
              "field": "age",
              "type": "nominal",
              "title": "Age",
              "scale": {"domain": ["0 - 4", "5 - 9", "10 - 14", "15 - 19", "20 - 24", "25 - 29", "30 - 34", "35 - 39", "40 - 44", "45 - 49", "50 - 54", "55 - 59", "60 - 64", "65 - 69", "70 - 74", "75 - 79", "80 - 84", "85+"]}
            },
            "color": {
              "aggregate": "sum",
              "field": "population",
              "type": "quantitative",
              "scale": {"scheme": "redpurple"},
              "legend": {"title": "Population"}
            }
          },
          "mark": "rect",
          "width": 300,
          "height": 300
        }
    ],
    "resolve": {
      "legend": {"color": "independent"},
      "scale": {"color": "independent"}
    },
    "config": {}
  }